<!-- vault.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBzkTSn1Xec-kGSHPahtCQ-nhmni3qzAIs",
    authDomain: "neuraplumb-temp.firebaseapp.com",
    projectId: "neuraplumb-temp",
    storageBucket: "neuraplumb-temp.appspot.com",
    messagingSenderId: "496029226738",
    appId: "1:496029226738:web:f837e91b9df82ad78b1b9b"
  };
  firebase.initializeApp(firebaseConfig);
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vault Placeholder</title>
</head>
<body>
  <img id="previewImage" src="" alt="Job Preview" width="300" style="display: none;" />
  <div id="scoreDisplay" style="margin-top: 20px;"></div>

  <h1>Vault Placeholder</h1>
  <p>This is where TrustQuote will live.</p>

  <h2>Your Vault</h2>
  <div id="vault"></div>

  <script type="module">
    const params = new URLSearchParams(window.location.search);
    const imageUrl = params.get("imgUrl");
    const score = params.get("score");
    const jobType = params.get("jobType");
    const profile = params.get("profile") || "standard";

    function getDifficulty(score) {
  const s = String(score);
  switch (s) {
    case "1": return "Extreme";
    case "2": return "High";
    case "3": return "Moderate";
    case "4": return "Light";
    case "5": return "Simple";
    default: return "Unknown";
  }
}

    console.log("✅ imageUrl param:", imageUrl);
    console.log("✅ score param:", score);
    console.log("✅ jobType param:", jobType);
    console.log("✅ profile param:", profile);

    const img = document.getElementById("previewImage");
    const scoreDisplay = document.getElementById("scoreDisplay");

    if (imageUrl) {
      img.src = imageUrl;
      img.style.display = "block";
      img.style.borderRadius = "12px";
      img.style.marginTop = "20px";
    }

    if (score) {
      const badge = document.createElement("div");
      badge.textContent = `NeuraScore: ${score}`;
      badge.style.backgroundColor = getBadgeColor(score);
      badge.style.color = "white";
      badge.style.padding = "10px 20px";
      badge.style.borderRadius = "30px";
      badge.style.fontSize = "18px";
      badge.style.fontWeight = "bold";
      badge.style.display = "inline-block";
      badge.style.marginTop = "20px";
      badge.style.boxShadow = "0 2px 6px rgba(0,0,0,0.2)";
      scoreDisplay.appendChild(badge);
      const profileSelector = document.createElement("select");
      profileSelector.style.marginTop = "16px";
      profileSelector.style.padding = "6px";
      profileSelector.style.borderRadius = "6px";
      profileSelector.style.fontSize = "14px";

      ["standard", "premium"].forEach(option => {
        const opt = document.createElement("option");
        opt.value = option;
        opt.textContent = option.charAt(0).toUpperCase() + option.slice(1);
        profileSelector.appendChild(opt);
      });

      profileSelector.value = profile;
      scoreDisplay.appendChild(profileSelector);

      const trustContainer = document.createElement("div");
trustContainer.style.marginTop = "12px";
trustContainer.style.padding = "12px";
trustContainer.style.border = "1px solid #ddd";
trustContainer.style.borderRadius = "8px";
trustContainer.style.maxWidth = "300px";
trustContainer.style.background = "#fafafa";

function renderTrustQuote() {
  trustContainer.innerHTML = `
    <div style="font-weight:bold;margin-bottom:6px;">TrustQuote</div>
    <div><strong>Difficulty:</strong> ${getDifficulty(score)}</div>
    <div><strong>Labor Range:</strong> ${getPriceRange(score, jobType, profileSelector.value)}</div>
    <p style="font-style: italic; margin-top: 8px;">
      ${getQuoteSummary(score, jobType)}
    </p>
  `;
}

scoreDisplay.appendChild(trustContainer);
renderTrustQuote();
profileSelector.addEventListener("change", renderTrustQuote);

const footer = document.createElement("div");
footer.style.marginTop = "16px";
footer.style.fontSize = "12px";
footer.style.color = "#888";
footer.style.textAlign = "right";
footer.textContent = "Powered by NeuraPlumb™";

scoreDisplay.appendChild(footer);

}

function getQuoteSummary(score, jobType) {
  const s = String(score);
  const jt = String(jobType || "");

  if (s === "1") return "This job may involve severe failure risks and should be reviewed immediately.";
  if (s === "2") return "This install falls below expected standards. Review is recommended.";
  if (s === "3" && jt === "Repipe") return "Repiping jobs at this difficulty often involve trenching, rerouting, and permit compliance.";
  if (s === "3") return "This job has moderate complexity with some risk factors.";
  if (s === "4") return "Above average quality with minimal labor complexity.";
  if (s === "5") return "This install meets elite standards. Minimal labor expected.";

  return "";
}

function getPriceRange(score, jobType, profile = "standard") {
  const s = String(score);
  const jt = String(jobType || "");
  const p = String(profile);

  if (s === "3" && jt === "Repipe" && p === "standard") {
    return "$1,600 – $2,400";
  }

  if (s === "3" && jt === "Repipe" && p === "premium") {
    return "$1,800 – $2,700";
  }

  switch (s) {
    case "1": return "$2,500 – $4,000";
    case "2": return "$1,800 – $2,800";
    case "3": return "$1,200 – $1,800";
    case "4": return "$800 – $1,200";
    case "5": return "$300 – $800";
    default: return "Varies";
  }
}


    async function loadVaultData() {
  const user = firebase.auth().currentUser;
  if (!user) return;

  const vaultContainer = document.getElementById('vault');
  vaultContainer.innerHTML = ''; // Clear current entries

  const querySnapshot = await firebase.firestore()
    .collection('uploads')
    .where('userId', '==', user.uid)
    .orderBy('timestamp', 'desc')
    .get();

  querySnapshot.forEach(doc => {
    const profile = params.get("profile") || "standard";
    const data = doc.data();
    const card = document.createElement('div');
    card.classList.add('vault-card');

    const jobColorMap = {
  Repipe: "#ffd54f",
  Sewer: "#81c784",
  WaterHeater: "#4fc3f7",
  Drain: "#ff8a65",
  Inspection: "#ce93d8"
};
const tagColor = jobColorMap[data.jobType] || "#eee";

    card.innerHTML = `
      <img src="${data.imageUrl}" alt="Plumbing Photo" class="vault-thumb" />
      <div class="vault-info">
        <div><strong>Score:</strong> ${data.mockScore}</div>
        <div>
  <strong>Job Type:</strong> 
  <span style="padding:2px 6px; border-radius:6px; background:${tagColor}; font-size:12px; font-weight:bold;">
  ${data.jobType || 'N/A'}
</span>
</div>
        <div><strong>Date:</strong> ${new Date(data.timestamp?.toDate()).toLocaleString()}</div>
      </div>
    `;

    vaultContainer.appendChild(card);
  });
}
    firebase.auth().signInWithEmailAndPassword("jaymz6435@gmail.com", "Elara572025!")
  .then(() => console.log("✅ Signed in manually"))
  .catch(err => console.error("❌ Sign-in failed:", err));
    
    firebase.auth().onAuthStateChanged(user => {
      console.log("👤 Signed-in user:", user ? user.uid : "None");
  if (user) {
    loadVaultData();
  }
});
    function getBadgeColor(score) {
  const s = String(score); // Normalize to string
  switch (s) {
    case "1": return "red";
    case "2": return "orange";
    case "3": return "yellow";
    case "4": return "green";
    case "5": return "blue";
    default: return "gray";
  }
}
  </script>
</body>
</html>

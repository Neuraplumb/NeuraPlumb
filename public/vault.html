<!-- vault.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBzkTSn1Xec-kGSHPahtCQ-nhmni3qzAIs",
    authDomain: "neuraplumb-temp.firebaseapp.com",
    projectId: "neuraplumb-temp",
    storageBucket: "neuraplumb-temp.appspot.com",
    messagingSenderId: "496029226738",
    appId: "1:496029226738:web:f837e91b9df82ad78b1b9b"
  };
  firebase.initializeApp(firebaseConfig);
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vault Placeholder</title>
</head>
<body>
  <img id="previewImage" src="" alt="Job Preview" width="300" style="display: none;" />
  <div id="scoreDisplay" style="margin-top: 20px;"></div>

  <h1>Vault Placeholder</h1>
  <p>This is where TrustQuote will live.</p>

  <h2>Your Vault</h2>
  <div id="vault"></div>

  <script type="module">
    const params = new URLSearchParams(window.location.search);
    const imageUrl = params.get("imgUrl");
    const score = params.get("score");
    const jobType = params.get("jobType");

    function getDifficulty(score) {
  const s = String(score);
  switch (s) {
    case "1": return "Extreme";
    case "2": return "High";
    case "3": return "Moderate";
    case "4": return "Light";
    case "5": return "Simple";
    default: return "Unknown";
  }
}

    console.log("âœ… imageUrl param:", imageUrl);
    console.log("âœ… score param:", score);
    console.log("âœ… jobType param:", jobType);

    const img = document.getElementById("previewImage");
    const scoreDisplay = document.getElementById("scoreDisplay");

    if (imageUrl) {
      img.src = imageUrl;
      img.style.display = "block";
      img.style.borderRadius = "12px";
      img.style.marginTop = "20px";
    }

    if (score) {
      const badge = document.createElement("div");
      badge.textContent = `NeuraScore: ${score}`;
      badge.style.backgroundColor = getBadgeColor(score);
      badge.style.color = "white";
      badge.style.padding = "10px 20px";
      badge.style.borderRadius = "30px";
      badge.style.fontSize = "18px";
      badge.style.fontWeight = "bold";
      badge.style.display = "inline-block";
      badge.style.marginTop = "20px";
      badge.style.boxShadow = "0 2px 6px rgba(0,0,0,0.2)";
      scoreDisplay.appendChild(badge);
    }

    const trustContainer = document.createElement("div");
trustContainer.style.marginTop = "12px";
trustContainer.style.padding = "12px";
trustContainer.style.border = "1px solid #ddd";
trustContainer.style.borderRadius = "8px";
trustContainer.style.maxWidth = "300px";
trustContainer.style.background = "#fafafa";

trustContainer.innerHTML = `
  <div style="font-weight:bold;margin-bottom:6px;">TrustQuote</div>
  <div><strong>Difficulty:</strong> ${getDifficulty(score)}</div>
  <div><strong>Labor Range:</strong> ${getPriceRange(score, jobType)}</div>
`;

scoreDisplay.appendChild(trustContainer);

function getPriceRange(score, jobType, profile = "standard") {
  const s = String(score);
  const jt = String(jobType || "");
  const p = String(profile);

  if (s === "3" && jt === "Repipe" && p === "standard") {
    return "$1,600 â€“ $2,400";
  }

  if (s === "3" && jt === "Repipe" && p === "premium") {
    return "$1,800 â€“ $2,700";
  }

  switch (s) {
    case "1": return "$2,500 â€“ $4,000";
    case "2": return "$1,800 â€“ $2,800";
    case "3": return "$1,200 â€“ $1,800";
    case "4": return "$800 â€“ $1,200";
    case "5": return "$300 â€“ $800";
    default: return "Varies";
  }
}


    async function loadVaultData() {
  const user = firebase.auth().currentUser;
  if (!user) return;

  const vaultContainer = document.getElementById('vault');
  vaultContainer.innerHTML = ''; // Clear current entries

  const querySnapshot = await firebase.firestore()
    .collection('uploads')
    .where('userId', '==', user.uid)
    .orderBy('timestamp', 'desc')
    .get();

  querySnapshot.forEach(doc => {
    const data = doc.data();
    const card = document.createElement('div');
    card.classList.add('vault-card');

    card.innerHTML = `
      <img src="${data.imageUrl}" alt="Plumbing Photo" class="vault-thumb" />
      <div class="vault-info">
        <div><strong>Score:</strong> ${data.mockScore}</div>
        <div><strong>Job Type:</strong> ${data.jobType || 'N/A'}</div>
        <div><strong>Date:</strong> ${new Date(data.timestamp?.toDate()).toLocaleString()}</div>
      </div>
    `;

    vaultContainer.appendChild(card);
  });
}
    firebase.auth().signInWithEmailAndPassword("jaymz6435@gmail.com", "Elara572025!")
  .then(() => console.log("âœ… Signed in manually"))
  .catch(err => console.error("âŒ Sign-in failed:", err));
    
    firebase.auth().onAuthStateChanged(user => {
      console.log("ðŸ‘¤ Signed-in user:", user ? user.uid : "None");
  if (user) {
    loadVaultData();
  }
});
    function getBadgeColor(score) {
  const s = String(score); // Normalize to string
  switch (s) {
    case "1": return "red";
    case "2": return "orange";
    case "3": return "yellow";
    case "4": return "green";
    case "5": return "blue";
    default: return "gray";
  }
}
  </script>
</body>
</html>

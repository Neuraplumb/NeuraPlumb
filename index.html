<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NeuraPlumb Scoring Tool</title>
    <script type="module">
      // Firebase SDKs
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";
      import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      // Firebase config (corrected)
      const firebaseConfig = {
        apiKey: "AIzaSyBzkTSn1Xec-kGSHPahtCQ-nhmni3qzAIs",
        authDomain: "neuraplumb.firebaseapp.com",
        projectId: "neuraplumb",
        storageBucket: "neuraplumb-temp.firebasestorage.app",
        messagingSenderId: "329025414261",
        appId: "1:329025414261:web:547b1254f89215b82d443c"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const storage = getStorage(app);
      const db = getFirestore(app);

      // Auto login
      signInWithEmailAndPassword(auth, "jaymz6435@gmail.com", "Elara572025!")
        .then(() => console.log("‚úÖ Signed in to Firebase"))
        .catch((err) => alert("Login error: " + err.message));

      // Global score handler
      window.getScore = async function () {
        const photoInput = document.getElementById("photo");
        const job = document.getElementById("job").value;
        const scope = document.getElementById("scope").value;
        const resultDiv = document.getElementById("result");

        if (!photoInput.files.length || !job || !scope) {
          resultDiv.innerText = "‚ùó Please complete all fields.";
          return;
        }

        const photo = photoInput.files[0];
        const user = auth.currentUser;
        if (!user) {
          alert("Not signed in");
          return;
        }

        // Upload to Storage
        const fileRef = ref(storage, `uploads/${user.uid}/${photo.name}`);
        try {
          await uploadBytes(fileRef, photo);
          console.log("‚úÖ Upload successful");

          // Log to Firestore
          await addDoc(collection(db, "uploads"), {
            uid: user.uid,
            fileName: photo.name,
            jobType: job,
            scope: scope,
            timestamp: serverTimestamp()
          });
          console.log("üì¶ Logged to Firestore");

          // Placeholder score message
          resultDiv.innerText = `‚è≥ Upload complete. Scoring in progress...`;
          setTimeout(() => {
            resultDiv.innerText = `‚úÖ NeuraScore pending integration. Upload succeeded.`;
          }, 1500);

        } catch (e) {
          console.error("Upload failed", e);
          resultDiv.innerText = "‚ùå Upload or logging failed.";
        }
      };
    </script>

    <style>
      body {
        font-family: Arial;
        padding: 2rem;
        max-width: 600px;
        margin: auto;
      }
      label, select, input, button {
        display: block;
        margin-top: 1rem;
        width: 100%;
      }
      #result {
        margin-top: 2rem;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>NeuraPlumb Scoring Tool</h1>

    <label for="photo">Upload Photo:</label>
    <input type="file" id="photo" />

    <label for="job">Job Type:</label>
    <select id="job">
      <option value="">Select Job Type</option>
      <option value="water_heater">Water Heater</option>
      <option value="sewer">Sewer</option>
      <option value="repipe">Copper Repipe</option>
      <option value="drain">Drain Repair</option>
    </select>

    <label for="scope">Scope of Work:</label>
    <select id="scope">
      <option value="">Select Scope</option>
      <option value="full_install">Full Install</option>
      <option value="repair_only">Repair Only</option>
      <option value="replacement">Replacement</option>
    </select>

    <button onclick="getScore()">Get NeuraScore</button>
    <div id="result"></div>
  </body>
</html>

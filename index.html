<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NeuraPlumb Scoring Tool</title>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";
      import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      // ‚úÖ Final working config
      const firebaseConfig = {
        apiKey: "AIzaSyBzkTSn1Xec-kGSHPahtCQ-nhmni3qzAIs",
        authDomain: "neuraplumb-temp.firebaseapp.com",
        projectId: "neuraplumb-temp",
        storageBucket: "neuraplumb-temp.firebasestorage.app",
        messagingSenderId: "1054125523956",
        appId: "1:1054125523956:web:e509376f1011371b64efa1"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const storage = getStorage(app);
      const db = getFirestore(app);

      // Auto login
      signInWithEmailAndPassword(auth, "jaymz6435@gmail.com", "Elara572025!")
        .then(() => console.log("‚úÖ Signed in"))
        .catch((err) => alert("Login error: " + err.message));

      window.getScore = async function () {
        const job = document.getElementById("job").value;
        const scope = document.getElementById("scope").value;
        const fileInput = document.getElementById("photo");
        const resultDiv = document.getElementById("result");

        if (!job || !scope || fileInput.files.length === 0) {
          resultDiv.innerText = "‚ùó Please complete all fields.";
          return;
        }

        const photo = fileInput.files[0];
        const user = auth.currentUser;
        if (!user) {
          alert("You must be signed in to upload.");
          return;
        }

        // Upload
        const fileRef = ref(storage, `uploads/${user.uid}/${photo.name}`);
        try {
          await uploadBytes(fileRef, photo);
          console.log("‚úÖ Upload successful");

          // Log to Firestore
          await addDoc(collection(db, "uploads"), {
            uid: user.uid,
            fileName: photo.name,
            jobType: job,
            scope: scope,
            timestamp: serverTimestamp()
          });
          console.log("üì¶ Logged to Firestore");

          // Score placeholder
          resultDiv.innerText = `‚è≥ Upload complete. Scoring in progress...`;
          setTimeout(() => {
            resultDiv.innerText = `‚úÖ NeuraScore pending integration. Upload succeeded.`;
          }, 1500);
        } catch (e) {
          console.error("Upload failed", e);
          resultDiv.innerText = "‚ùå Upload failed. Check console.";
        }
      };
    </script>

    <style>
      body { font-family: Arial; padding: 2rem; max-width: 600px; margin: auto; }
      label, select, input, button { display: block; margin-top: 1rem; width: 100%; }
      #result { margin-top: 2rem; font-weight: bold; }
    </style>
  </head>

  <body>
    <h1>NeuraPlumb Scoring Tool</h1>

    <label for="photo">Upload Photo:</label>
    <input type="file" id="photo" />

    <label for="job">Job Type:</label>
    <select id="job">
      <option value="">Select Job Type</option>
      <option value="water_heater">Water Heater</option>
      <option value="sewer">Sewer</option>
      <option value="repipe">Copper Repipe</option>
      <option value="drain">Drain Repair</option>
    </select>

    <label for="scope">Scope of Work:</label>
    <select id="scope">
      <option value="">Select Scope</option>
      <option value="full_install">Full Install</option>
      <option value="repair_only">Repair Only</option>
      <option value="replacement">Replacement</option>
    </select>

    <button onclick="getScore()">Get NeuraScore</button>
    <div id="result"></div>
  </body>
</html>

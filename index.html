<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NeuraPlumb Scoring Tool</title>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBzkTSn1Xec-kGSHPahtCQ-nhmni3qzAIs",
        authDomain: "neuraplumb.firebaseapp.com",
        projectId: "neuraplumb",
        storageBucket: "neuraplumb-temp.firebasestorageapp.com",
        messagingSenderId: "329025414261",
        appId: "1:329025414261:web:547b1254f89215b82d443c"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const storage = getStorage(app);

      // Auto-login
      signInWithEmailAndPassword(auth, "jaymz6435@gmail.com", "Elara572025!")
        .then(() => console.log("✅ Firebase signed in"))
        .catch((err) => alert("Login error: " + err.message));

      window.getScore = async function () {
        const job = document.getElementById("job").value;
        const scope = document.getElementById("scope").value;
        const fileInput = document.getElementById("photo");
        const resultDiv = document.getElementById("result");

        if (!job || !scope || fileInput.files.length === 0) {
          resultDiv.innerText = "❗ Please complete all fields.";
          return;
        }

        const photo = fileInput.files[0];
        const user = auth.currentUser;
        if (!user) {
          alert("You must be signed in to upload.");
          return;
        }

        const fileRef = ref(storage, `uploads/${user.uid}/${photo.name}`);
        try {
          await uploadBytes(fileRef, photo);
          console.log("✅ Upload successful");

          const mockScore = Math.floor(Math.random() * 5) + 1;
          resultDiv.innerText = `✅ Your NeuraScore: ${mockScore}/5 (mock)`;
        } catch (e) {
          console.error("Upload failed", e);
          resultDiv.innerText = "❌ Upload failed. Check console for details.";
        }
      };
    </script>

    <style>
      body { font-family: Arial; padding: 2rem; max-width: 600px; margin: auto; }
      label, select, input, button { display: block; margin-top: 1rem; width: 100%; }
      #result { margin-top: 2rem; font-weight: bold; }
    </style>
  </head>
  <body>
    <h1>NeuraPlumb Scoring Tool</h1>
    <label for="photo">Upload Photo:</label>
    <input type="file" id="photo" />

    <label for="job">Job Type:</label>
    <select id="job">
      <option value="">Select Job Type</option>
      <option value="water_heater">Water Heater</option>
      <option value="sewer">Sewer</option>
      <option value="repipe">Copper Repipe</option>
      <option value="drain">Drain Repair</option>
    </select>

    <label for="scope">Scope of Work:</label>
    <select id="scope">
      <option value="">Select Scope</option>
      <option value="full_install">Full Install</option>
      <option value="repair_only">Repair Only</option>
      <option value="replacement">Replacement</option>
    </select>

    <button onclick="getScore()">Get NeuraScore</button>
    <div id="result"></div>
  </body>
</html>
